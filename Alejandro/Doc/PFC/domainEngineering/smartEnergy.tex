%%==================================================================%%
%% Author : Pérez Ruiz, Alejandro                                   %%
%% Author : Sánchez Barreiro, Pablo                                 %%
%% Version: 1.1, 18/06/2011                                         %%
%%                                                                  %%
%% Memoria del Proyecto Fin de Carrera                              %%
%% Domain Engineering/smartEnergy                                   %%
%%==================================================================%%

%%==================================================================%%
%% NOTA(Pablo): En realidad no es esto lo que tiene que hacer,      %%
%%              pero a estas alturas, lo dejaremos pasar            %%
%%==================================================================%%
La característica para el control de inteligente de
la energía (\emph{SmartEnergyMng}) tiene dos objetivos principales:

\begin{enumerate}
	\item Siempre que los aparatos de control de la temperatura estén
		  encendidos se deben cerrar todas las ventanas para evitar pérdidas de energía;
	\item Almacenar los horarios de los habitantes de la casa, de modo que:
		\begin{itemize}
			\item Siempre que la casa esté vacía los aparatos de control de la temperatura
					estén apagados.
			\item Encender dichos aparatos con la suficiente antelación para poder restablecer la temperatura elegida por el usuario a su regreso a casa.
		\end{itemize}
\end{enumerate}

Para realizar dicha funcionalidad, esta característica precisa usar las características de control automático de ventanas (\emph{WindowMng}) y de la gestión de la temperatura (\emph{HeaterMng}).

%%==================================================================%%
%% HECHO(Pablo): Haz el diseño UML de esta característica e intenta  %%
%%              que se parezca a las anteriores. Procura ser breve  %%
%%              y diferenciar diseño de implementación              %%
%%==================================================================%%
\begin{figure}[!h]
 \centering
 \includegraphics[width=.55\linewidth]{domainEngineering/Images/SmartEnergyMngDesign.eps} \\
 \caption{Diseño del control inteligente de energía}
 \label{domain:fig:smartDesign}
\end{figure}

La Figura~\ref{domain:fig:smartDesign} muestra el diseño de esta característica, y al igual que todas las demás características descritas en las secciones anteriores, se redefine la clase parcial \imp{Gateway} para a través de ella añadir varios métodos que nos permitan implementar los requisitos.

En primer lugar para desarrollar el requisito que almacena los horarios de los habitantes se utiliza el metalenguaje de etiquetas XML \cite{rusty:2004}, a través de él se almacena en un fichero el nombre, apellidos y los intervalos de tiempo en el que no se encuentra en casa cada habitante. Con los métodos \imp{findEmptyTime} y \imp{checkTime} se comprueba, cada vez que el tiempo sea modificado, si la casa está vacía, y en el caso de que esté vacía se desconectarán todos los calefactores o se encenderán en el caso de que el tiempo se aproxime a la llegada de los usuarios.

El siguiente requisito que es necesario implementar es el encargado de cerrar las ventanas cuando los calefactores estén funcionando, por lo que se nos presenta una situación como la descrita en la Sección \ref{domain:sec:pattern}, en la que es necesario sobreescribir un método. De tal modo que se debe seguir el procedimiento descrito en dicha Sección, ya que el método que modifica la temperatura de un calefactor debe de cambiar su comportamiento para poder comprobar el estado de las ventanas, y cerrarlas si se da el caso. Por lo tanto el método tendrá un aspecto como el mostrado en la figura \ref{domain:fig:codSmartEnergy} cuando la característica actual esté seleccionada en una configuración.
 
\begin{figure}[ht!]
\begin{center}
\begin{footnotesize}
\begin{verbatim}
00 public void heaterAdjustTemperature(int id_heater, double temperature)
01 {
02      smartEnergyMng_heaterAdjustTemperature(id_heater, temperature);
03 }
\end{verbatim}
\end{footnotesize}
\end{center}
\caption{Implementación del método heaterAdjustTemperature cuando la característica \emph{SmartEnergyMng} está seleccionada}
\label{domain:fig:codSmartEnergy}
\end{figure}

Nuevamente se necesita definir las interfaces gráficas para esta característica, para el caso de la interfaz que representa al Gateway, únicamente se añade una nueva pestaña global que contendrá un botón que activa o desactiva el control inteligente de energía y un campo que permite introducir la temperatura que se quiere tener cuando se reconecten los calefactores después de que la casa haya estado vacía. Mientras que la interfaz gráfica que representa al simulador, implementa una nueva pestaña para esta característica, en la que se puede modificar el tiempo del sistema, debido a que el sistema no funciona bajo una construcción real de una hogar inteligente, por lo que de este modo se podrá modificar el tiempo a nuestro antojo para facilitar las tareas de simulación. Por otro lado también se ha añadido una lista con los intervalos de tiempo en la que la casa se encuentra vacía, tal y como se ilustra en la figura \ref{domain:fig:SimulatorSmartEnergyMng}.
\begin{figure}[!tb]
 \centering
 \includegraphics[width=.75\linewidth]{domainEngineering/Images/simulatorGUISmartEnergyMng.eps} \\
 \caption{Diseño de la interfaz gráfica de usuario para el simulador en la característica de \emph{SmartEnergyMng}}
 \label{domain:fig:SimulatorSmartEnergyMng}
\end{figure}

Para realizar las pruebas correspondientes de esta característica se han dividido en varios tests, el primer de ellos es el encargado de verificar los métodos destinados a leer y encontrar en el fichero XML los horarios en los que la casa se encuentre vacía, para ello se ha modifica dicho fichero en varias ocasiones, en las cuales la mitad de las veces el número de habitantes era impar y en la otra mitad par, además de añadir de un modo aleatorio horarios a los habitantes, en los que al menos existiese un intervalo en el que la casa estuviese vacía en la mitad de las ocasiones.

Otro conjunto de tests son los destinados a comprobar que los calefactores se apagan y se encienden correctamente si la casa está vacía, por lo que nuevamente se utilizan los ficheros XML anteriores en los que la casa está vacía y se comprueba que si el control de energía inteligente está encendido se comporta correctamente. De tal modo que se crean una serie de instancias de la casa con diferente número de calefactores distribuidos por distintas habitaciones y se comprueba.

La última batería de tests es la encargada de comprobar que las ventanas son cerradas si el control de energía está encendido y alguno de los calefactores de la casa está encendido. Por lo tanto se crean diferentes estancias de la casa con distintas distribuciones de ventanas y calefactores en las habitaciones, y se comprueba que todas las ventanas son cerradas siempre y cuando se cumplan las dos condiciones anteriores.

La siguiente sección describirá brevemente las iteraciones restantes para terminar de implementar la ingeniería de domino de esta línea de productos software.


