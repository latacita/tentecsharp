%%==================================================================%%
%% Author : Pérez Ruiz, Alejandro                                   %%
%% Author : Sánchez Barreiro, Pablo                                 %%
%% Version: 1.1, 18/06/2011                                         %%
%%                                                                  %%
%% Memoria del Proyecto Fin de Carrera                              %%
%% Domain Engineering/smartEnergy                                   %%
%%==================================================================%%

La característica para el control de inteligente de
la energía (\emph{SmartEnergyMng}) tiene dos objetivos principales:

\begin{enumerate}
	\item Siempre que los aparatos de control de la temperatura estén
		  encendidos se deben cerrar todas las ventanas para evitar pérdidas de energía.
	\item Almacenar los horarios de los habitantes de la casa, de modo que:
		\begin{itemize}
			\item Siempre que la casa esté vacía los aparatos de control de la temperatura
					estén apagados.
			\item Encender dichos aparatos con la suficiente antelación para poder restablecer la temperatura elegida por el usuario a su regreso a casa.
		\end{itemize}
\end{enumerate}

Para realizar dicha funcionalidad, esta característica precisa usar las características de control automático de ventanas (\emph{WindowMng}) y de la gestión de la temperatura (\emph{HeaterMng}).

\begin{figure}[!h]
 \centering
 \includegraphics[width=.55\linewidth]{domainEngineering/Images/SmartEnergyMngDesign.eps} \\
 \caption{Diseño del control inteligente de energía}
 \label{domain:fig:smartDesign}
\end{figure}

La Figura~\ref{domain:fig:smartDesign} muestra el diseño de esta característica. Al igual que en las demás características hasta ahora descritas, la clase \imp{Gateway} se declara como parcial para añadir nuevos métodos, y en este caso, sobreescribir algunos de los ya existentes gracias al esquema presentado en la Sección~\ref{domain:sec:pattern}.


Los diferentes horarios de los habitantes de la casa se almacenan en una hoja XML~\cite{rusty:2004}. El objetivo de los métodos \imp{findEmptyTime} es analizar las franjas de tiempo en las cuales la casa está vacía. El método \imp{checkTime} se encarga, a intervalos regulares de tiempo, de conectar o desconectar los aparatos de control de la temperatura según la casa esté vacía, esperando la llegada de un habitante, u ocupada.

A la hora de implementar el cierre de las ventanas cuando los calefactores estén funcionando, necesitaremos sobreescribir el método \imp{adjustTemperature} de la versión del \imp{Gateway} para la característica de gestión de la temperatura (ver Figura~\ref{domain:fig:heaterMngDesign}). Para ellos usamos el patrón descrito en la
Sección~\ref{domain:sec:pattern}. La implementación del método \imp{adustTemperature} se muestra en la Figura~\ref{domain:fig:codSmartEnergy}.

%%=======================================================================================================%%
%% HECHO(Pablo): Poner aquí abreviado el método adjustTemperature de la clase Gateway de la               %%
%%              característica SmartEnergy                                                               %%
%%=======================================================================================================%%
 \begin{figure}[ht!]
 \begin{center}
 \begin{footnotesize}
 \begin{verbatim}
 00 public void heaterAdjustTemperature(int id_heater, double temperature)
 01 {
 02      smartEnergyMng_heaterAdjustTemperature(id_heater, temperature);
 03 }
 \end{verbatim}
 \end{footnotesize}
 \end{center}
 \caption{Implementación del método heaterAdjustTemperature
          cuando la característica \emph{SmartEnergyMng} está seleccionada}
 \label{domain:fig:codSmartEnergy}
 \end{figure}



%%=======================================================================================================%%
%% NOTA(Pablo): Esto ahora se borra                                                                      %%
%%=======================================================================================================%%
% la figura \ref{domain:fig:codSmartEnergy} cuando la característica actual esté seleccionada en una configuración.
%

De nuevo se necesita definir las interfaces gráficas para esta característica. Para el caso de la interfaz de usuario, únicamente se añade una nueva pestaña global que contendrá un botón para activar o desactivar el control inteligente de energía, así como especificar la temperatura que se desea tener cuando se reconecten los calefactores después de que la casa haya estado vacía. La interfaz gráfica del simulador implementa una nueva pestaña para esta característica. En dicha pestaña se puede modificar el tiempo del sistema, con objeto de simular su paso. Además,  se muestra una lista con los intervalos de tiempo en la que la casa se encuentra vacía. (Ver Figura~\ref{domain:fig:SimulatorSmartEnergyMng}).

\begin{figure}[!tb]
 \centering
 \includegraphics[width=.75\linewidth]{domainEngineering/Images/simulatorGUISmartEnergyMng.eps} \\
 \caption{Diseño de la interfaz gráfica de usuario para el simulador en la característica de \emph{SmartEnergyMng}}
 \label{domain:fig:SimulatorSmartEnergyMng}
\end{figure}

Las pruebas correspondientes a esta característica se han dividido en varios tests. El primer test debe verificar los métodos destinados a procesar la hoja XML  con los horarios de los habitantes. Para ello se han probado diversos ficheros, conteniendo horarios con diferentes características, tales como situaciones en las cuales la casa nunca se encuentre vacía.

El siguiente conjunto de tests están destinados a comprobar que los aparatos de control de la temperatura se apagan y se encienden correctamente de forma automática cuando la casa está vacía. Para ellos se crean diferentes instancias de la casa con un número arbitrario de dispositivos de control de la temperatura y se verifica que su comportamiento es el deseado.

La última batería de tests se encarga de comprobar que las ventanas se cierran si el control inteligente de energía está encendido y alguno de los aparatos de control de la temperatura entra en funcionamiento. Al igual que antes, se crean diferentes instancias de la casa y se comprueba su correcto funcionamiento.


